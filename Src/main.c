/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 ******************************************************************************
 * @attention
 *
 * Copyright (c) 2024 STMicroelectronics.
 * All rights reserved.
 *
 * This software is licensed under terms that can be found in the LICENSE file
 * in the root directory of this software component.
 * If no LICENSE file comes with this software, it is provided AS-IS.
 *
 ******************************************************************************
 */

#include <stdint.h>
//#include "ErrType.h"
#include "RCC_interface.h"
#include "GPIO_interface.h"
#include "SYSTIC_interface.h"
#include "USART_interface.h"

void setup(void)
{

	 RCC_AHB1EnableClk(AHB1_GPIOA);
	 RCC_APB1Enable(APB1_USART2);


	 GPIO_PIN_CFG_t PINA5 =
	 {
			 .Port = PORTA ,
			 .PinNum = PIN5 ,
			 .Mode = OUTPUT ,
			 .OutputType = PUSH_PULL

	 };




	 GPIO_PIN_CFG_t USART_TX_PIN = {
			.AltFunc=AF7, .Mode=ALTERNATIVE_FUNCTION, .OutputType=PUSH_PULL,
			.PinNum=PIN2, .Port=PORTA
	};

	 GPIO_PIN_CFG_t USART_RX_PIN = {
			.AltFunc=AF7, .Mode=ALTERNATIVE_FUNCTION, .OutputType=PUSH_PULL,
			.PinNum=PIN3, .Port=PORTA
	};





	 GPIO_u8PinInit(&USART_TX_PIN);
	 GPIO_u8PinInit(&USART_RX_PIN);


	 GPIO_u8PinInit(&PINA5);

}

int main(void)
{
	setup();



	USART_ConfigReg_t UART2 =
	{
			.USART_MODE = USART_RXTX ,
			.USART_BAUDRATE = 9600 ,
			.USART_HWFLOWCONTROL = USART_HW_FLOW_CONTROL_OFF ,
			.USART_STOPBITS = USART_ONE_STOP_BITS,
			.USART_WORDLENGTH = USART_EIGHT_BIT ,
			.USART_PARITYBIT = USART_NO_PARITY ,
			.USART_USARTNUMBER = USART_USART2 ,
			.USART_OVERSAMPLINGMODE = USART_OVER8_ ,
			.USART_SYNCHMODE = USART_ASYNCH
	};

	USART_Init(&UART2);

	uint8_t RX_Data = '1' ;

	uint8_t password[5] = "1234";




	while(1)
	{
		USART_ReceiveData(&UART2, &RX_Data);
		USART_TransmitData(&UART2, RX_Data);

		USART_TransmitString(&UART2 , "\n the current password : ");
		USART_TransmitString(&UART2 , password);

		USART_TransmitString(&UART2 , "\n Enter new password :  ");
		USART_ReceiveBuffer(&UART2,password ,4 );

		USART_TransmitString(&UART2 , password);

		if(RX_Data == '1')
		{
			GPIO_u8SetPinValue(PORTA, PIN5, HIGH);
		}

		else if (RX_Data == '2')
		{
			GPIO_u8SetPinValue(PORTA, PIN5, LOW);

		}



	}

}
